# Malware Analysis
*Write up and utils*

## Agent Tesla

**decrypt_tesla_strings.py**: it decrypts strings embedded in the .NET Agent Tesla executable. To use it, `pip install pycryptodome`, then run the script with a file containing the encrypted strings. The format should correspond to an array of the following structure:
```C
struct encrypted_string{
    unsigned int length; // length of cipher is variable
    char key[32];
    char iv[16];
    char *cipher;
};
```
It follows the same structure that the one in Agent Tesla except for the length attribute. The script `write_buf.py` can be used to create the file, once the buffer of encrypted strings is extracted using a decompiler like dnSpy. A less dirty way would be to detect and extract the buffer directly from memory. ;)

![agent_tesla_encrypted_strings](./agent_tesla/utils/agent_tesla.PNG)

